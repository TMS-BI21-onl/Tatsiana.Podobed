1.	Покажите всех менеджеров, которые имеют в подчинении больше 6-ти сотрудников.

SELECT COUNT(e.EMPLOYEES_ID), e.MANAGER_ID
FROM EMPLOYEES e
WHERE e.MANAGER_ID IN (SELECT EMPLOYEES_ID
					FROM EMPLOYEES m
					JOIN JOBS j ON m.JOB_ID = j.JOB_ID
					WHERE JOB_TITLE = 'Менеджер') m
GROUP BY e.MANAGER_ID 
HAVING COUNT(e.EMPLOYEES_ID)>6

2.	Вывести min и max зарплату с вычетом commission_pct для каждого департамента. (commission_pct на базе указывается в процентах). 

SELECT DEPARTMENT_NAME, MIN(SALARY-(SALARY*(COMMISSION_PST/100))),MAX(SALARY-(SALARY*(COMMISSION_PST/100))) as ZPnew
FROM EMPLOYEES e
JOIN DEPERTMENTS d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
GROUP BY DEPARTMENT_NAME

3.	Вывести только регион, где работают больше всего людей.

SELECT TOP 1 REGION_NAME
FROM EMPLOYEES e
JOIN DEPARTMENTS d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID
JOIN LOCATIONS l ON d.LOCATION_ID = l.OCATION_ID
JOIN COUNTRIES c ON l.COUNTRY_ID = c.COUNTRY_ID
JOIN REGIONS r ON c.REGION_ID = r.REGION_ID
GROUP BY REGION_NAME
ORDER BY COUNT(EMPLOYEE_ID) DESC

4.	Найдите разницу в процентах между средней зп по каждому департаменту от общей средней (по всем департаментам).

SELECT DEPARTMENT_NAME, ((AVG_FULL-AVG_D)/AVG_FULL)*100
FROM (SELECT DEPARTMENT_NAME, AVG(SALARY) OVER (PARTITION BY DEPERTMENT_ID) as AVG_D, AVG(SALARY) OVER () as AVG_FULL
	  FROM EMPLOYEES e
	  JOIN DEPERTMENTS d ON e.DEPARTMENT_ID = d.DEPARTMENT_ID) x1

5.	Найдите людей, кто проработал больше, чем 10 лет в одном департаменте. 

SELECT DISTINCT EMPLOYEE_ID
FROM (SELECT EMPLOYEE_ID, DEPERTMENT_ID, DATEDIFF(year, START_DATE, END_DATE_New) AS WORK_YEAR
	  FROM (SELECT EMPLOYEE_ID, DEPERTMENT_ID, START_DATE, CASE WHEN END_DATE IS NULL THEN GETDATE() ELSE END_DATE AS END_DATE_New
		    FROM EMPLOYEES e
		    JOIN JOB_HISTORY j ON e.EMPLOYEE_ID = j.EMPLOYEE_ID) x1
GROUP BY EMPLOYEE_ID, DEPERTMENT_ID
HAVING SUM(WORK_YEAR) > 10

6.	Найдите людей, кто занимает 5-10 место по размеру зарплаты.  

SELECT EMPLOYEE_ID
FROM (SELECT EMPLOYEE_ID, DENSE_RANK() OVER (ORDER BY SALARY DESC) AS Mesto
      FROM EMPLOYEES e)
WHERE Mesto between 5 and 10